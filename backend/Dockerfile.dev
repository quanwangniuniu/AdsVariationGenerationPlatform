
# Development Dockerfile for Django Backend
# This version is optimized for development with hot reloading and debugging capabilities
# Key differences from production:
# - Uses Django development server instead of Gunicorn
# - Installs development dependencies
# - Code is mounted as volumes (not copied)
# - Runs as root for easier file permissions in development
# - Includes debugging tools and verbose logging

FROM python:3.11-slim

# Set environment variables for development
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV DJANGO_SETTINGS_MODULE=backend.settings

WORKDIR /app


# Install system dependencies (same as production but with additional dev tools)
RUN apt-get update && apt-get install -y \
    libmagic1 \
    libmagic-dev \
    gcc \
    g++ \
    curl \
    # Additional development tools
    vim \
    git \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better caching
# In development, we still copy requirements to leverage Docker layer caching
COPY requirements.txt .

# Install Python dependencies including development packages
# Note: In production we use --no-cache-dir, but in dev we might want to cache for faster rebuilds
RUN pip install -r requirements.txt


# Install additional development dependencies if you have a separate requirements-dev.txt
# COPY requirements-dev.txt .
# RUN pip install -r requirements-dev.txt

# Copy and set permissions for entrypoint
COPY entrypoint-dev-b.sh /app/entrypoint-dev-b.sh
RUN chmod +x /app/entrypoint-dev-b.sh

# Expose port
EXPOSE 8000


# Set entrypoint
ENTRYPOINT ["/app/entrypoint-dev-b.sh"]

# Default command: start Django development server with hot reloading
# This provides auto-reload when code changes (when mounted as volume)
CMD ["runserver"]

